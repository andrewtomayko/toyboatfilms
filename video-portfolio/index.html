<script>
  async function loadVideos() {
    const res = await fetch("/data/videos.json", { cache: "no-store" });
    if (!res.ok) throw new Error("Could not load /data/videos.json");
    const data = await res.json();
    return data.videos || [];
  }

  function render(videos) {
    const grid = document.getElementById("videoGrid");

    grid.innerHTML = videos.map(v => {
      const href = v.type === "youtube"
        ? `https://www.youtube.com/watch?v=${v.id}`
        : `https://vimeo.com/${v.id}`;

      const thumb = v.type === "youtube"
        ? `https://img.youtube.com/vi/${v.id}/hqdefault.jpg`
        : (v.thumb || "");

      return `
        <a class="card glightbox"
           href="${href}"
           data-gallery="videos"
           data-type="video"
           data-title="${v.title}">
          ${thumb ? `<img class="thumb" src="${thumb}" alt="${v.title}">` : `<div class="thumb" style="background:#222"></div>`}
          <div class="play"><span>â–¶</span></div>
          <div class="meta">
            <p class="title">${v.title}</p>
            <p class="tag">${v.tag || ""}</p>
          </div>
        </a>
      `;
    }).join("");

    GLightbox({ selector: ".glightbox" });
  }

  (async () => {
    try {
      const videos = await loadVideos();
      render(videos);
    } catch (e) {
      console.error(e);
      document.getElementById("videoGrid").innerHTML =
        "<p style='color:#b6b6bd'>Could not load videos. Check /data/videos.json</p>";
    }
  })();
</script>
